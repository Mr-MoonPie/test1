// Parameters
Boolean SENDDEPLOYMENTEMAIL = false;
String TRAIL_NAME ='EBike';
String MODULE_NAME = 'Module02'; // e.g. Module01
String DEPLOYMENTNAME = TRAIL_NAME+' '+MODULE_NAME+'';
String COMMIT_ID = 'afd7b16b9f30a3fd622acce37f8218c41574fe24';
String COMMIT_NAME = '';
String BRANCH_NAME = 'Module02-EbikeApp';
String GITREPOSITORY_NAME = '';
Boolean SEED_METADATA = true;
Boolean SEED_DATA = false; 
String DESTINATION_ORG_NAME ='Dev1'; // Options: Dev1, Dev2, UAT, Production, Hotfix, Copado

//[{"t":"ApexClass","n":"AccountOperations","s":true}]
String STEPDATA_GITMETADATA = '[{"t":"CustomTab","n":"Product_Explorer","s":true},{"t":"CustomTab","n":"Product_Family__c","s":true},{"t":"CustomTab","n":"Order__c","s":true},{"t":"CustomTab","n":"Product__c","s":true},{"t":"CustomApplication","n":"EBikes","s":true},{"t":"Layout","n":"Order__c-Order Layout","s":true},{"t":"Layout","n":"Product__c-Product Layout","s":true},{"t":"Layout","n":"Product_Family__c-Product Family Layout","s":true},{"t":"Layout","n":"Order_Item__c-Order Item Layout","s":true},{"t":"ContentAsset","n":"logo","s":true},{"t":"CustomObject","n":"Product_Family__c","s":true},{"t":"CustomObject","n":"Product__c","s":true},{"t":"CustomObject","n":"Order_Item__c","s":true},{"t":"CustomObject","n":"Order__c","s":true},{"t":"Profile","n":"Admin","s":true}]';
String STEPDATA_APEX = '';

private static copado__Deployment__c insertDeployment() {
	copado__Deployment__c x = new copado__Deployment__c();
	x.Name = DEPLOYMENTNAME;
	x.copado__Send_Deployment_Complete_email__c = SENDDEPLOYMENTEMAIL;
	insert x;
	insertDestinationOrg(x.Id);
	return x;
}
private static void insertDestinationOrg(Id dId) {
	copado__Destination_Org__c x = new copado__Destination_Org__c();
	x.copado__Deployment__c = dId;
	x.copado__To_Org__c = [select Id from copado__Org__c where copado__Environment__r.Name=:DESTINATION_ORG_NAME limit 1].Id;
	insert x;
}

private static copado__Step__c setGitStepValues(copado__Step__c x) {
	x.copado__Branch__c = BRANCH_NAME;
	x.copado__Commit_Id__c = COMMIT_ID;
	x.copado__Commit_Name__c = COMMIT_NAME;
	x.copado__Git_Repository__c = [select Id from copado__Git_Repository__c where Name=:GITREPOSITORY_NAME Limit 1].Id;
	x.copado__DataJson__c = '{"testLevel":"NoTestRun","replacements":[]}';
	return x;
}
private static copado__Step__c createDeploymentStep(Id dId, Integer iorder, String stepType, String stepName) {
	copado__Step__c x = new copado__Step__c();
	x.Name = stepName;
	x.copado__Deployment__c = dId;
	x.copado__Order__c = iorder;
	x.copado__Type__c = stepType;
	x.copado__CheckOnly__c = false;
	if(stepType=='Git MetaData') x = setGitStepValues(x);
	return x;
}

private static void updateStep(copado__Step__c step, Id attachmentId) {
	step.copado__Attachment_Id__c = attachmentId;
	update step;
}
private static Attachment insertAttachment(Id parentId, String name, String b) {
	Attachment x = new Attachment(ParentId=parentId, Name=name, body=Blob.valueOf(b));
	insert x;
	return x;
}




//Execute Apex anonymous code DO NOT MODIFY THE BELOW CODE
copado__Deployment__c depl = insertDeployment();

if(SEED_METADATA) {
	copado__Step__c step1 = createDeploymentStep(depl.Id, 1, 'Git MetaData', MODULE_NAME+' Metadata');
	insert step1;
	Attachment step1att = insertAttachment(step1.Id, 'MetaData', STEPDATA_GITMETADATA);
	updateStep(step1, step1att.Id);
}
if(SEED_DATA) {
	copado__Step__c step2 = createDeploymentStep(depl.Id, 2, 'Apex', MODULE_NAME+' data');
	insert step2;
	Attachment step2att = insertAttachment(step2.Id, 'Apex', STEPDATA_APEX);
}
